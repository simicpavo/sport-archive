<!-- Main container -->
<div class="min-h-screen p-6 text-white">
  <!-- Header and filter section -->
  <div class="mx-auto mb-8 max-w-4xl">
    <h1 class="mb-6 text-center text-2xl font-bold">Latest Sports News</h1>

    <div class="flex justify-center gap-2">
      @for (filter of timeFilters; track filter.value) {
        <button
          class="rounded px-4 py-2 font-medium transition-colors"
          [class.bg-gray-700]="selectedFilter() !== filter.value"
          [class.bg-teal-500]="selectedFilter() === filter.value"
          [class.hover:bg-gray-600]="selectedFilter() !== filter.value"
          [class.text-gray-300]="selectedFilter() !== filter.value"
          [class.text-white]="selectedFilter() === filter.value"
          (click)="onTimeFilterChange(filter.value)"
        >
          {{ filter.label }}
        </button>
      }
    </div>
  </div>

  <!-- Error state -->
  @if (error()) {
    <div class="mx-auto mb-6 max-w-4xl">
      <div class="rounded-lg border border-red-700 bg-red-900/50 p-4 text-red-200">
        <div class="flex items-center gap-2">
          <i class="pi pi-exclamation-triangle text-red-400"></i>
          <span>Failed to load news. Please try again.</span>
        </div>
      </div>
    </div>
  }

  <!-- Loading skeletons -->
  @if (loading()) {
    <div class="mx-auto max-w-4xl space-y-4">
      @for (item of [1, 2, 3, 4, 5]; track item) {
        <div class="rounded-lg bg-gray-800 p-6">
          <div class="mb-4 flex items-center gap-3">
            <p-skeleton shape="circle" size="40px" />
            <div>
              <p-skeleton class="mb-2" height="1rem" width="8rem" />
              <p-skeleton height="0.8rem" width="6rem" />
            </div>
          </div>
          <p-skeleton class="mb-3" height="1.5rem" width="90%" />
          <p-skeleton class="mb-2" height="1rem" width="100%" />
          <p-skeleton height="1rem" width="80%" />
        </div>
      }
    </div>
  }

  <!-- News list -->
  @if (!loading() && news().length > 0) {
    <div class="mx-auto max-w-4xl space-y-6">
      @for (newsItem of news(); track newsItem.id) {
        <article class="hover:bg-gray-750 rounded-lg bg-gray-800 p-6 transition-colors">
          <!-- Article header -->
          <div class="mb-4 flex items-center gap-3">
            @if (newsItem.mediaSource) {
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-gray-700">
                @if (newsItem.mediaSource.logoUrl) {
                  <img
                    class="h-full w-full rounded-full object-cover"
                    [alt]="newsItem.mediaSource.name"
                    [src]="newsItem.mediaSource.logoUrl"
                  />
                } @else {
                  <i class="pi pi-globe text-gray-400"></i>
                }
              </div>
              <div>
                <h4 class="font-medium text-white">{{ newsItem.mediaSource.name }}</h4>
              </div>
            } @else {
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-gray-700">
                <i class="pi pi-newspaper text-gray-400"></i>
              </div>
              <div>
                <h4 class="font-medium text-white">Sports News</h4>
                <p class="text-sm text-gray-400">{{ formatDate(newsItem.createdAt) }}</p>
              </div>
            }
          </div>

          <!-- Article content -->
          <h3 class="mb-3 text-xl leading-tight font-semibold text-white">
            {{ newsItem.title }}
          </h3>

          <p class="mb-4 leading-relaxed text-gray-300">
            {{ newsItem.content }}
          </p>

          <!-- Engagement stats -->
          <div class="mb-4 flex items-center gap-6 text-sm text-gray-400">
            <div class="flex items-center gap-1">
              <span class="text-red-400">‚ù§Ô∏è</span>
              <span>{{ formatEngagements(newsItem.likeCount || 0) }}</span>
            </div>
            <div class="flex items-center gap-1">
              <span class="text-blue-400">üí¨</span>
              <span>{{ formatEngagements(newsItem.commentCount || 0) }}</span>
            </div>
            <div class="flex items-center gap-1">
              <span class="text-green-400">üîÑ</span>
              <span>{{ formatEngagements(newsItem.shareCount || 0) }}</span>
            </div>
            <div class="flex items-center gap-1">
              <span class="text-purple-400">üë•</span>
              <span>{{ formatEngagements(newsItem.totalEngagements || 0) }} total</span>
            </div>
          </div>

          <!-- Read Article button -->
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-500">{{ formatDate(newsItem.createdAt) }}</div>
            <div class="flex gap-2">
              <button
                class="rounded bg-gray-700 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-teal-600"
                type="button"
                (click)="onSaveArticle(newsItem)"
              >
                Save Article
              </button>
              <button
                class="rounded bg-teal-500 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-teal-600"
                type="button"
                (click)="onReadMore(newsItem)"
              >
                Read Article
              </button>
            </div>
          </div>
        </article>
      }
    </div>
  }

  <!-- Load more trigger - Only show when there's actually more to load -->
  @if (!loading() && hasMore() && news().length > 0) {
    <div class="py-6" id="scroll-trigger">
      @if (loadingMore()) {
        <div class="mx-auto max-w-4xl">
          <div class="rounded-lg bg-gray-800 p-6">
            <div class="flex items-center justify-center gap-3 text-gray-400">
              <div class="h-6 w-6 animate-spin rounded-full border-b-2 border-teal-500"></div>
              <span>Loading more news...</span>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- End of content message -->
  @if (!loading() && !hasMore() && news().length > 0) {
    <div class="my-12 text-center">
      <div class="text-gray-500">üéØ You've reached the end! That's all the news for now.</div>
      @if (total() > 0) {
        <div class="mt-2 text-sm text-gray-600">
          Showing {{ news().length }} of {{ total() }} articles
        </div>
      }
    </div>
  }

  <!-- Empty state -->
  @if (!loading() && news().length === 0) {
    <div class="mx-auto max-w-4xl py-12 text-center">
      <div class="rounded-lg bg-gray-800 p-12">
        <div class="mb-4 text-6xl">üì≠</div>
        <h3 class="mb-4 text-xl font-semibold text-white">No news found</h3>
        <p class="mb-6 text-gray-400">
          It seems like there's no sports news available for the selected time period. Try adjusting
          your filter or check back later for fresh content!
        </p>
        <button
          class="rounded bg-teal-500 px-4 py-2 font-medium text-white transition-colors hover:bg-teal-600"
          [disabled]="loading()"
          (click)="loadInitialNews()"
        >
          @if (loading()) {
            <div class="mr-2 h-4 w-4 animate-spin rounded-full border-b-2 border-white"></div>
          }
          üîÑ Refresh
        </button>
      </div>
    </div>
  }
</div>

<!-- Save Article Dialog -->
<p-dialog
  [breakpoints]="{ '960px': '75vw', '640px': '90vw' }"
  [modal]="true"
  [style]="{ width: '40vw' }"
  [visible]="showDialog()"
  (visibleChange)="showDialog.set($event)"
>
  @if (selectedNewsItem(); as article) {
    <app-records-form
      [initialData]="{ title: article.title, description: article.content }"
      (recordCancelled)="closeDialog()"
      (recordSaved)="onSaveRecord($event)"
    />
  }
</p-dialog>
